We gather pieces from various repositories, here is the snapshot process:

date=<date>

git fetch --all

git checkout dde-upstream
git pull incubator dde:dde-upstream

git checkout dde
git pull . dde-upstream
# Remove files added outside DDE
git push incubator dde:dde-debian
git tag -m "New upstream snapshot" -a upstream/dde/$date
for dir in devnode libbpf libdde-linux26 libddekit libhurd-slab libmachdev
do
	git archive HEAD $dir | bzip2 > ../hurd_$date.orig-$dir.tar.bz2
done

git checkout eth
git pull . dde-upstream
# Remove files added outside eth-*
git tag -m "New upstream snapshot" -a upstream/eth/$date
for dir in eth-filter eth-multiplexer
do
	git archive HEAD $dir | bzip2 > ../hurd_$date.orig-$dir.tar.bz2
done

git checkout random
git pull incubator random
git tag -m "New upstream snapshot" -a upstream/random/$date
git archive --prefix=random/ HEAD | bzip2 > ../hurd_$date.orig-random.tar.bz2

git checkout procfs-jkoenig
git pull procfs master:procfs-jkoenig
git tag -m "New upstream snapshot" -a upstream/procfs/$date
git archive --prefix=procfs/ HEAD | bzip2 > ../hurd_$date.orig-procfs.tar.bz2

git checkout upstream
git pull upstream master:upstream
git tag -m "New upstream snapshot" -a upstream/hurd/$date
git archive --prefix=hurd-$date/ HEAD | bzip2 > ../hurd_$date.orig.tar.bz2

git checkout upstream-merged
for dir in devnode libbpf libdde-linux26 libhurd-slab libmachdev eth-filter eth-multiplexer random procfs
do
	tar -xf ../hurd_$date.orig-$dir.tar.bz2
done
tar --strip-components=1 -xf ../hurd_$date.orig.tar.bz2
git add -A
git commit -m "New upstream snapshot"

git checkout master
git pull . upstream-merged
