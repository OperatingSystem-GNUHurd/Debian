https://savannah.gnu.org/bugs/?26751

2009-06-07  Zheng Da  <zhengda1936@gmail.com>

	* Makefile: Use customized default_pager.defs.

	* proxy-defpager.c: Include customized default_pager header.

---
 Makefile         |    7 +++++--
 proxy-defpager.c |    5 +++--
 2 files changed, 8 insertions(+), 4 deletions(-)

Index: hurd-debian/trans/Makefile
===================================================================
--- hurd-debian.orig/trans/Makefile	2012-11-26 00:23:22.000000000 +0000
+++ hurd-debian/trans/Makefile	2012-11-26 00:25:32.000000000 +0000
@@ -26,7 +26,7 @@
 	fakeroot.c proxy-defpager.c
 OBJS = $(SRCS:.c=.o) fsysServer.o ifsockServer.o passwordServer.o \
 	crashServer.o crash_replyUser.o msgServer.o \
-	default_pagerServer.o default_pagerUser.o \
+	ourdefault_pagerServer.o ourdefault_pagerUser.o \
 	device_replyServer.o elfcore.o
 HURDLIBS = ports netfs trivfs iohelp fshelp pipe ihash shouldbeinlibc
 LDLIBS += -lpthread
@@ -34,6 +34,9 @@
 
 include ../Makeconf
 
+ourdefault_pager.defs: default_pager.defs
+	$(CPP) $(CPPFLAGS) -x c $< | sed -e '/MACH_MSG_TYPE_MAKE_SEND;/s/MAKE/COPY/' | sed -e '/subsystem/iserverprefix S_;' > $@
+
 vpath elfcore.c $(top_srcdir)/exec
 
 symlink: fsysServer.o
@@ -41,7 +44,7 @@
 crash: crashServer.o crash_replyUser.o msgServer.o elfcore.o
 password: passwordServer.o
 streamio: device_replyServer.o
-proxy-defpager: default_pagerServer.o default_pagerUser.o
+proxy-defpager: ourdefault_pagerServer.o ourdefault_pagerUser.o
 
 proxy-defpager crash password streamio: ../libports/libports.a ../libtrivfs/libtrivfs.a ../libfshelp/libfshelp.a
 fifo new-fifo: ../libpipe/libpipe.a
Index: hurd-debian/trans/proxy-defpager.c
===================================================================
--- hurd-debian.orig/trans/proxy-defpager.c	2012-11-26 00:23:22.000000000 +0000
+++ hurd-debian/trans/proxy-defpager.c	2012-11-26 00:25:32.000000000 +0000
@@ -23,9 +23,10 @@
 #include <error.h>
 #include <version.h>
 #include <hurd/paths.h>
+#include <string.h>
 
-#include "default_pager_S.h"
-#include "default_pager_U.h"
+#include "ourdefault_pager_S.h"
+#include "ourdefault_pager_U.h"
 
 static mach_port_t real_defpager, dev_master;
 
