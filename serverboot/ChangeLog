2007-06-06  Thomas Schwinge  <tschwinge@gnu.org>

	* default_pager.c (default_pager_object_create,	default_pager_info)
	(default_pager_objects, default_pager_object_pages)
	(default_pager_object_set_size,	default_pager_paging_file): Rename to
	`S_default_pager_object_create', `S_default_pager_info',
	`S_default_pager_objects', `S_default_pager_object_pages',
	`S_default_pager_object_set_size' and `S_default_pager_paging_file'.

2006-03-15  Alfred M. Szmidt  <ams@gnu.org>

	* kalloc.c: #include <malloc.h>.
	(init_hook, malloc_hook, free_hook): New functions.
	(__malloc_initialize_hook): New variable.
	(malloc, free): Functions removed.

2003-05-07  Ognyan Kulev  <ogi@fmi.uni-sofia.bg>

	* strfcns.c: #include <stdarg.h> instead of <varargs.h>.
	(strbuild): Use <stdarg.h>-style for handling variable argument
	list.
	* load.c: Don't #include <varargs.h>.

2002-07-03  Roland McGrath  <roland@frob.com>

	* elf-load.c (exec_load): Fix e_machine checking.

	* elf-load.c (exec_load): Fix typos in last change.

2002-06-22  Roland McGrath  <roland@frob.com>

	* load.c (boot_script_exec_cmd): Twiddle decls of serverboot_bunzip2
	and serverboot_gunzip.

	* elf-load.c (exec_load) [__alpha__]: Grok Elf64_* headers and check
	for EM_ALPHA.
	* exec.c (set_regs) [__alpha__]: Alpha implementation snarfed from CMU
	file bootstrap/alpha/exec.c in MK83a.

	* load.c (boot_script_exec_cmd): Cast int to intptr_t before char *.

2002-06-14  Roland McGrath  <roland@frob.com>

	* default_pager.c: #include "default_pager_S.h"

2002-05-29  Roland McGrath  <roland@frob.com>

	* bootstrap.c (main): int -> integer_t for boot_script values.

2002-05-23  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile: Fix last change properly, by relaxing the rule again
	and adding our source dir before the exec dir.

2002-05-23  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile: Fix last change, constraining vpath even further.

2002-05-20  Ognyan Kulev <ogi@fmi.uni-sofia.bg>

	* Makefile: Move inclusion of ../Makeconf before using $(srcdir)
	and constrain vpath directives to avoid using ../exec/exec.o.

2002-05-07  Roland McGrath  <roland@frob.com>

	* default_pager.c (part_id): Add const to argument type.

2002-03-23  Roland McGrath  <roland@frob.com>

	Excised default pager functionality from serverboot.
	* Makefile (SRCS): Move def_pager_setup.c default_pager.c kalloc.c to
	(EXTRA_DIST): ... here.
	(OBJS): Remove *Server.o from here.
	(MIGSFLAGS): Variable removed.
	* bootstrap.c (main): Replace paging-file boot-script functions with a
	stub that prints an error.  No longer call partition_init,
	default_pager_initialize, or default_pager.
	(default_pager_bootstrap_port): Variable removed.
	(main): Don't use it.
	(default_pager_exception_port): Declaration removed.
	(main): Don't use it.
	* default_pager.c (default_pager_bootstrap_port): Variable removed.
	(default_pager_demux_default): Don't use it.
	(default_pager_initialize): Likewise.
	(default_pager): Likewise.
	(do_bootstrap_privileged_ports, bootstrap_compat): Functions removed.
	[mips] (set_ras_address): Likewise.

	* default_pager.c (pager_truncate): New function.
	(struct dpager): New member `limit'.
	(pager_alloc): Initialize it.
	(default_pager_object_set_size): New function.
	(seqnos_memory_object_lock_completed): Rewritten, no longer a stub.
	(default_pager_demux_object): Try default_pager_server too.

2001-11-24  Roland McGrath  <roland@frob.com>

	* Makefile (installationdir): Use $(bootdir).

2001-08-16  Roland McGrath  <roland@frob.com>

	* Makefile (OBJS): Add userland-boot.o here.
	Add a vpath to find userland-boot.c in boot/ too.
	* bootstrap.c (parse_script): Pass new arg to boot_script_parse_line.
	* load.c: Include <stddef.h> before "boot_script.h".

2001-07-20  Roland McGrath  <roland@frob.com>

	* panic.c: Fix obsolescent #endif syntax.
	* ext2_file_io.c: Likewise.
	* disk_inode_ffs.h: Likewise.
	* ffs_file_io.c: Likewise.

2001-03-31  Roland McGrath  <roland@frob.com>

	* assert.h: Fix obsolescent #endif syntax.
	* default_pager.c: Likewise.
	* queue.h: Likewise.
	* load.c: Likewise.

2001-02-28  Roland McGrath  <roland@frob.com>

	* default_pager.c: Use <file_io.h> instead of "file_io.h",
	so mach-defpager gets its own version when it uses this source file.
	(new_partition): If CHECK_LINUX_SIGNATURE arg is -3, don't print out.

2001-01-11  Marcus Brinkmann  <marcus@gnu.org>

	* def_pager_setup.c: Include <mach/mig_errors.h> and
	<mach/default_pager_types.h>.
	(default_pager_paging_storage): New stub.

2000-04-03  Roland McGrath  <roland@baalperazim.frob.com>

	* panic.c: Include <stdarg.h> instead of <varargs.h>.
	(panic): Use stdarg style.

2000-01-03  Roland McGrath  <roland@baalperazim.frob.com>

	* file_io.h: Include "../ext2fs/ext2_fs.h" instead of "ext2_fs.h".
	* ext2_file_io.c (search_directory): Use `struct ext2_dir_entry_2' in
	place of `struct ext2_dir_entry', so as to grok newer dir formats.
	* ext2_fs.h: File removed.
	* Makefile (LCLHDRS): Remove it from the list.
	* ffs_compat.c (EXT2_INODES_PER_BLOCK): New macro, no longer in
	ext2_fs.h.

1999-11-18  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (default_pager): Instead of suspending this thread,
	just become the default_pager_default_thread thread ourselves.

	* wiring.c (wire_all_memory): Touch pages before wiring.

1999-11-16  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (default_pager_initialize): Use MACH_PORT_VALID to
	check old DMM port, rather than just checking for MACH_PORT_NULL.

	* strfcns.c (index): Function removed.

	* ffs_file_io.c (ffs_open_file): Use memmove instead of ovbcopy.
	* ext2_file_io.c (ext2_open_file): Likewise.
	* strfcns.c (ovbcopy): Function removed.

1999-11-08  Roland McGrath  <roland@baalperazim.frob.com>

	* bootstrap.c (main): Further spruce up prompting and error reporting
	for root device and boot script.

1999-10-28  Roland McGrath  <roland@baalperazim.frob.com>

	* load.c, bootstrap.c: Back out some debugging printfs accidentally
	included in the last commit.
	* bootstrap.c (main): Increase size of NEW_ROOT buffer.
	This change was included in the last commit, but not logged then.

	* file_io.h: Include <errno.h>.
	(FS_* macros): Define these to equivalent errno codes.
	* def_pager_setup.c (add_paging_file): Put strerror of result code in
	error messages.
	* bootstrap.c (parse_script): Likewise.
	* load.c (boot_script_exec_cmd): Include NAMEBUF in error messages,
	and use strerror to format result code.
	* panic.c (panic): Use program_invocation_name in message.

1999-10-08  Thomas Bushnell, BSG  <tb@mit.edu>

	* bootstrap.c: (DEFAULT_ROOT): Remove macro.
	(main): If no root device was specified, then prompt as if the
	user had specified -a.  Don't use strcpy to move NEW_ROOT into
	ROOT_NAME; that's unsafe.

1999-10-06  Roland McGrath  <roland@baalperazim.frob.com>

	* bootstrap.c (DEFAULT_ROOT): Change to "hd0s1".

1999-08-20  Roland McGrath  <roland@baalperazim.frob.com>

	* bootstrap.c (parse_script): Add one to the buffer size so we can
	null-terminate after the end of the file.

1999-07-20  Roland McGrath  <roland@baalperazim.frob.com>

	* ext2_file_io.c, ffs_file_io.c, minix_file_io.c: Remove fs-specific
	routines *_page_{read,write}_file_direct.  Moved to ...
	* file_io.c (page_read_file_direct, page_write_file_direct): Don't
	call fs-specific routine, these are not fs-specific.  Instead,
	replaced with former fs-specific routines (which were all identical).
	Read and write more than a fs block when disk blocks are contiguous.

	* default_pager.c (new_partition): When reading Linux signature page,
	handle pager_read_file_direct returning sub-page blocks.

1999-06-03  Mark Kettenis  <kettenis@gnu.org>

	* default_pager.c (new_partition): Declare `waste' as `int'
	instead of `unsigned int'.

1999-06-02  Roland McGrath  <roland@baalperazim.frob.com>

	* load.c (boot_script_exec_cmd): Copy environment from our `environ'
	onto the new task's stack along with its arguments.

	* bootstrap.c (main): If we have a MULTIBOOT_CMDLINE environment
	variable, set its value as ${kernel-command-line} for boot scripts.

1999-05-29  Roland McGrath  <roland@baalperazim.frob.com>

	* bootstrap.c (main): Define $(serverboot) function for "serverboot
	controls", control command replacing the pathname.  For command "die",
	terminate ourselves after running the boot script, no default pager.

1999-05-23  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Fix arg order in printf for
	linux-2.2 signature page.

1999-05-20  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Fix SWAP-SPACE page handling.

1999-05-17  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Deallocate signature page when
	rejecting it for wrong version.  Fix typo in SWAPSPACE2 v1 bad block
	bitmap handling.  Free bitmap and partition structure if we reject the
	partition signature.
	Reported by Kalle Olavi Niemitalo <tosi@ees2.oulu.fi>.

	* default_pager.c (new_partition): Print out for
	CHECK_LINUX_SIGNATURE<0 case.

1999-05-15  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (new_partition): Check if requested partition is
	already in our list, and refuse it.

	* bootstrap.c (main): Remove vars HAD_A_PARITION, DOING_DEFAULT_PAGER.
	Remove $(default-pager) boot script tag.  We always stick around and
	act as the default pager (this was already the case, just removed some
	dead code).  Don't print anything about having no swap partitions,
	since that is a fine way to boot (just use swapon later).

	* default_pager.c (new_partition): Print out partition name and size
	when no signature.

1998-09-06  OKUJI Yoshinori  <okuji@kuicr.kyoto-u.ac.jp>

	* bunzip2.c: New file.
	* load.c (GZIP) (BZIP2): New cpp constants.
	(boot_script_exec_cmd): If GZIP is defined, gunzip engine is enabled.
	If BZIP2 is defined, bunzip2 engine is enabled.
	* Makefile (SRCS): Add bunzip2.c.
	(UNZIP_OBJS): Add do-bunzip2.o.
	(CPPFLAGS): Add -DGZIP, -DBZIP2 and -DSMALL_BZIP2.

1998-09-03  OKUJI Yoshinori  <okuji@kuicr.kyoto-u.ac.jp>

	* gunzip.c: New file.
	Copy libstore/gunzip.c and modify for use in serverboot.
	* load.c (struct stuff): Add members, image_addr and image_size.
	(mem_read) (mem_read_exec): New functions.
	(boot_script_exec_cmd): Add gzexe feature.
	* Makefile: Add unzip stuffs.

1999-03-06  Roland McGrath  <roland@baalperazim.frob.com>

	* def_pager_setup.c (default_pager_setup): #if 0 out unused function.

	* default_pager.c (default_pager_paging_file): Pass 0 for new
	LINUX_SIGNATURE arg to add_paging_file.

	* bootstrap.c (main: scrript_paging_file): Pass LINUX_SIGNATURE arg
	through to add_paging_file.

1999-02-27  Roland McGrath  <roland@baalperazim.frob.com>

	* def_pager_setup.c (add_paging_file): New arg CHECK_LINUX_SIGNATURE,
	pass down to create_paging_partition.
	* default_pager.c (create_paging_partition): New arg
	CHECK_LINUX_SIGNATURE, pass down new_partition.
	(new_partition): New arg CHECK_LINUX_SIGNATURE: if not < 0,
	check first page of swap for Linux 2.0 or 2.2 signature page and obey
	its bad-block map; if > 0, refuse the partition if no signature found.
	* bootstrap.c (main): Add new boot script functions
	`add-raw-paging-file', `add-linux-paging-file'.  Make those
	and `add-paging-file' all call add_paging_file with new
	LINUX_SIGNATURE arg of -1, 1, and 0, respectively.
	* default_pager.c (create_paging_partition): If new_partition returns
	null, return and do nothing more.

1998-07-25  Roland McGrath  <roland@baalperazim.frob.com>

	* default_pager.c (pager_read_offset): Cast NO_BLOCK twice, to real
	return type of this function.

Tue May 12 12:11:36 1998  Thomas Bushnell, n/BSG  <tb@mit.edu>

	* bootstrap.c (parse_script): Free BUF before returning.  Reported
 	by Katusya Tanaka (wyvern@pb3.so-net.ne.jp).

1997-07-15  Miles Bader  <miles@gnu.ai.mit.edu>

	* bootstrap.c (main): Rearrange default pager initialization.

	* bootstrap.c (safe_gets): Use strchr instead of index.
	: Include <string.h>

	* bootstrap.c (main): Change "(bootstrap)" to "(serverboot)" in msgs.
	* load.c (boot_script_exec_cmd): Likewise.

1997-07-09  Miles Bader  <miles@gnu.ai.mit.edu>

	* bootstrap.c (main): Don't exit when no paging partition.

1997-07-08  Miles Bader  <miles@gnu.ai.mit.edu>

	* bootstrap.c: Don't include "translate_root.h".
	(main): Don't call translate_root.
	Pass more than a single character to safe_gets.
	(DEFAULT_ROOT): New macro.
	(safe_gets): Make sure a newline exists before removing it.
	Ensure that the cursor moves to the beginning of the next line.
	* translate_root.c, translate_root.h: Files removed.
	* Makefile (SRCS): Remove translate_root.c.
	(LCLHDRS): Remove translate_root.h.

Fri Jun 20 15:37:15 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* bootstrap.c (main/script_paging_file): Instead of returning an
	error use new variable `had_a_partition' to record whether we
	successfully opened a partition.
	(main/script_default_pager): Only start pager if HAD_A_PARTITION;
	otherwise print warning message.

Mon Jun 16 11:52:40 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* Makefile (installationdir): Use `=' to set this instead of :=;
	$(prefix) is not yet available and `=' postpones the evaluation
	properly.   Reported by Marcus G. Daniels,
	marcus@cathcart.sysc.pdx.edu.

Tue Jun 10 21:54:52 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* disk_inode.h (struct icommon): Use short instead of uid_t/gid_t
	in structure definition; those are now 32 bit types.

	* bootstrap.c (main): Support running from command line too; this
	is useful at least for simple debugging.

1997-06-09  Miles Bader  <miles@gnu.ai.mit.edu>

	* Makefile (LCLHDRS): Add mach-exec.h.

Thu May  1 18:40:53 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* bootstrap.c (cthread_stack_size): Don't set special value here;
	use the default.

Wed Apr 30 12:01:53 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c (default_pager_default_thread): Now that this is
 	forked, rather than run directly by the first thread, we have to
 	gain kernel privileges to acquire reserved pages.

Fri Apr 18 16:44:49 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* wiring.c (__vm_allocate): New function.

Wed Apr 16 14:18:28 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c (debug): Turn off.

Mon Apr 14 12:50:20 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c: Remove debugging printfs.

Thu Apr 10 15:10:25 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* Makefile (installationdir): Set variable.

Wed Apr  9 13:57:44 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* default_pager.c (default_pager_default_thread): New function.
	Delete old variable with this name, it was never used.
	(default_pager): Fork default_pager_default_thread instead of
	doing it here to avoid the possibility that we are on a tiny
	stack.  Current thread dies.

Thu Apr  3 20:00:58 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* elf-load.c (exec_load): Include <elf.h> instead of
	<mach/exec/elf.h>.  Include "mach-exec.h" instead of
	<mach/exec/elf.h>.
	(exec_load) [i386]: Check for i386 types directly; abandon old
	MY_EI_DATA and MY_E_MACHINE.
	* load.c: Include "mach-exec.h" instead of <mach/exec/elf.h>.
	* exec.c: Likewise.
	* mach-exec.h: New file.

Wed Mar 19 14:45:27 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* panic.c (panic): Clear possible errors on stdout before printing
	panic string.

Mon Mar 17 13:13:50 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* wiring.c (wire_all_memory): Don't attempt wire if PROTECTION is
	VM_PROT_NONE.

	* panic.c (panic): Be more informative about where the error is
	coming from.

	* default_pager.c (create_paging_partition): Don't print
	gratuitous output noise.
	* load.c (boot_script_exec_cmd): Likewise.

Wed Mar 12 10:53:00 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* ext2_file_io.c (ext2_open_file): Clear FP before beginning
	work.
	* ffs_file_io.c (ffs_open_file): Likewise.
	* minix_file_io.c (minix_open_file): Likewise.

	* bootstrap.c (printf_init, safe_gets): New functions.
	* console.c: Deleted file.
	* Makefile (SRCS): Omit console.c and gets.c.

	* load.c (read_symtab_from_file): Comment out body of function.
	We don't want this.

	* defs.h: Comment out redefinitions of common types.

	* default_pager.c: Include <cthreads.h> instead of
	<mach/cthreads.h>.
	* file_io.h: Likewise.
	* kalloc.c: Likewise.

	* panic.c: Include <varargs.h> instead of <sys/varargs.h>.

	* default_pager.c (pager_read_offset): Cast return of NO_BLOCK
	properly.

Mon Mar 10 17:07:50 1997  Thomas Bushnell, n/BSG  <thomas@gnu.ai.mit.edu>

	* load.c: Find boot_script.h in ../boot.
	* bootstrap.c: Likewise.

	* bootstrap.c (boot_panic): Repair syntax.

	* strfcns.c: Include <varargs.h> instead of <sys/varargs.h>.
	* load.c: Likewise.
